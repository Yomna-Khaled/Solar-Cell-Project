  <%= form_tag("/production_shifts/", :method => "post")%>
  <h1 align="center">
    <span class="page-header">Ordering Material</span>
  </h1>

<div class="container" style="width: 100;">
  <div class="well">
    <div class="table-responsive">

  <table class="table table-hover">
   <thead>
          <tr class="success">
            <th class="text-center" >Material</th>
            <th class="text-center" >Value</th>
            
          </tr>
        </thead>

    <% @materials.each do |material| %>

    <tr >
      <td>

        <%= check_box_tag  "material_id[]", material.id,false,options={:onchange=>'matvalue(this)',:id => "material_id_#{material.id}_#{material.name}"} %> 
        <%= material.name %>
      </td>
      <td>
        <%= number_field_tag  material.id , nil, options = {:placeholder=> "Enter the required quantity  ",:style => "display:none;margin-left: 150px"}%>
      </td>


      <br>
      <%= hidden_field_tag "hidden" %>
      <%= hidden_field_tag "manager", current_user.full_name  %>
      <%= hidden_field_tag "shift_id",current_shift.id %>

    </tr>
    <% end %>

  </table>
  </div>
  </div>
</div>






  <%= submit_tag("Complete order", :class=>"btn btn-success",:id=>"order",disabled: true) %>

<script>
index_checked=0; //to enable submit button
var field_id;
var manager=$("#manager").val();
var shift_id;
  
function matvalue(ptr){
  
   field_id=ptr.id.split("_")[2];
   

  var name=ptr.id.split("_")[3];
  
 
  var prev=$("#hidden").val();
  if(ptr.checked==true){
    index_checked+=1;
    $("#"+field_id).show();
    $("#"+field_id).attr("required", "true");
    $("#"+field_id).attr("min", "1");
    $("#"+field_id).keyup(function(){
      $("#hidden").val(prev+"_"+name+","+$("#"+field_id).val()+","+field_id);
    });
    

  }
  else if(ptr.checked==false){
    index_checked-=1;
    $("#"+field_id).hide();
    $("#"+field_id).removeAttr("required");
    $("#"+field_id).removeAttr("min");   
  }
  if (index_checked > 0) {
    $("#order").removeAttr('disabled');
  } else{
    $("#order").attr('disabled','disabled');
  };
}





window.dispatcher = new WebSocketRails('localhost:3000/websocket');
window.enjoy=dispatcher.subscribe ("yoyo");
$("#order").click(function(){
  shift_id=$("#shift_id").val();
  console.log(shift_id);
  var array=$("#hidden").val().split("_");
  var sent="";
  for(i=1;i<array.length;i++){
    sent=sent+"<tr id="+shift_id+"><td>"+manager+"</td><td>"+array[i].split(",")[0]+"</td><td>"+array[i].split(",")[1]+"</td><td><button class='btn btn-info' onclick='accept(this)' id="+array[i].split(",")[0]+"_"+array[i].split(",")[1]+"_"+array[i].split(",")[2]+">accept</button></td></tr>"

  }
	
enjoy.trigger ('order',sent);




});



</script>